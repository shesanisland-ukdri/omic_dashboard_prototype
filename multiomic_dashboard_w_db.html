<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-05-22">

<title>Multiomic Dashboard Viewer</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="multiomic_dashboard_w_db_files/libs/clipboard/clipboard.min.js"></script>
<script src="multiomic_dashboard_w_db_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="multiomic_dashboard_w_db_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="multiomic_dashboard_w_db_files/libs/quarto-html/popper.min.js"></script>
<script src="multiomic_dashboard_w_db_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="multiomic_dashboard_w_db_files/libs/quarto-html/anchor.min.js"></script>
<link href="multiomic_dashboard_w_db_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="multiomic_dashboard_w_db_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="multiomic_dashboard_w_db_files/libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="multiomic_dashboard_w_db_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="multiomic_dashboard_w_db_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="multiomic_dashboard_w_db_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="multiomic_dashboard_w_db_files/libs/bootstrap/bootstrap-ad9a7a92949a659f07e414c0483d3929.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="multiomic_dashboard_w_db_files/libs/bootstrap/bootstrap-dark-ad9a7a92949a659f07e414c0483d3929.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="multiomic_dashboard_w_db_files/libs/bootstrap/bootstrap-ad9a7a92949a659f07e414c0483d3929.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="multiomic_dashboard_w_db_files/libs/quarto-dashboard/quarto-dashboard.js"></script>
<script src="multiomic_dashboard_w_db_files/libs/quarto-dashboard/stickythead.js"></script>



<script src="multiomic_dashboard_w_db_files/libs/quarto-dashboard/web-components.js" type="module"></script>
<script src="multiomic_dashboard_w_db_files/libs/quarto-dashboard/components.js"></script>



</head>

<body class="quarto-dashboard quarto-light">

<header id="quarto-dashboard-header">
<nav class="navbar navbar-expand-md slim" data-bs-theme="dark">
  <div class="navbar-container container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#dashboard-collapse" aria-controls="dashboard-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>    


    <div class="navbar-brand-container">       
    <a href="#"><img src="./misc/ukdri_logo.jpg" alt="" class="navbar-logo d-inline-block"></a>
      <div class="navbar-title">
        <div class="navbar-title-text"><a href="#">Multiomic Dashboard Viewer</a></div>
        
        
      </div>
    </div>
<div id="dashboard-collapse" class="navbar-collapse collapse"><ul class="navbar-nav navbar-nav-scroll me-auto" role="tablist"><li class="nav-item" role="presentation"><a id="tab-homepage-dashboard" class="nav-link active" data-bs-toggle="tab" role="tab" data-bs-target="#homepage-dashboard" data-scrolling="true" href="#homepage-dashboard" aria-controls="homepage-dashboard" aria-selected="true"><span class="nav-link-text">Homepage Dashboard</span></a></li><li class="nav-item" role="presentation"><a id="tab-visualisation" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#visualisation" data-scrolling="true" href="#visualisation" aria-controls="visualisation" aria-selected="false"><span class="nav-link-text">Visualisation</span></a></li></ul></div></div>
</nav>
</header>
<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content dashboard-sidebar-container column-page" id="quarto-document-content">

<div class="bslib-sidebar-layout html-fill-item html-fill-container" data-bslib-sidebar-open="desktop" data-bslib-sidebar-init="true"><div class="main html-fill-container html-fill-item"><div class="sidebar-content html-fill-item html-fill-container">
<div class="tab-content bslib-grid html-fill-item html-fill-container" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div id="homepage-dashboard" class="dashboard-page tab-pane show active html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-homepage-dashboard">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 10fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="shiny-html-output col-sm-4 html-fill-item html-fill-container" id="total_datasets_box"></div>
</div>
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="shiny-html-output col-sm-4 html-fill-item html-fill-container" id="selected_datasets_box"></div>
</div>
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="shiny-html-output col-sm-4 html-fill-item html-fill-container" id="selected_genes_box"></div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div><div id="visualisation" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-visualisation">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 1fr) minmax(3em, max-content); grid-auto-columns: minmax(0, 1fr);">
<div class="card tabset html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header dashboard-card-no-title bslib-navs-card-title">

<ul class="nav nav-tabs card-header-tabs" role="tablist" data-tabsetid="card-tabset-2"><li class="nav-item" role="presentation"><a href="#card-tabset-2-1" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Experimental results" aria-selected="true" class="nav-link active">Experimental results</a></li><li class="nav-item" role="presentation"><a href="#card-tabset-2-2" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="QC Analysis" aria-selected="false" class="nav-link">QC Analysis</a></li><li class="nav-item" role="presentation"><a href="#card-tabset-2-3" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Differential Expression" aria-selected="false" class="nav-link">Differential Expression</a></li><li class="nav-item" role="presentation"><a href="#card-tabset-2-4" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Comparative Viewer" aria-selected="false" class="nav-link">Comparative Viewer</a></li><li class="nav-item" role="presentation"><a href="#card-tabset-2-5" role="tab" data-toggle="tab" data-bs-toggle="tab" data-value="Gene Regulatory Network (GRN)" aria-selected="false" class="nav-link">Gene Regulatory Network (GRN)</a></li></ul></div>





<div class="tab-content html-fill-item html-fill-container" data-tabset-id="card-tabset-2"><div class="tab-pane active show html-fill-item html-fill-container" role="tabpanel" id="card-tabset-2-1"><div class="card-body html-fill-item html-fill-container" data-title="Experimental results">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="row html-fill-item html-fill-container">
<div class="col-sm-12 html-fill-item html-fill-container">
<div class="datatables html-widget html-widget-output shiny-report-size html-fill-item html-fill-container" id="exp_table" style="width:100%;height:auto;"></div>
<p>Experimental data from the SQL database, including logFC and adjusted p-values across comparisons.</p>
</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div></div><div class="tab-pane html-fill-item html-fill-container" role="tabpanel" id="card-tabset-2-2"><div class="card-body html-fill-item html-fill-container" data-title="QC Analysis">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="row html-fill-item html-fill-container">
<div class="col-sm-4 html-fill-item html-fill-container">
<div id="qc_report_display" class="shiny-html-output html-fill-item html-fill-container" height="300px"></div>
<p>Uploaded QC report from FastQC or multiQC.</p>
</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div></div><div class="tab-pane html-fill-item html-fill-container" role="tabpanel" id="card-tabset-2-3"><div class="card-body html-fill-item html-fill-container" data-title="Differential Expression">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<pre class="shiny-text-output noplaceholder" id="threshold_summary"></pre>
</div>
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="form-group shiny-input-container html-fill-item html-fill-container">
<label class="control-label" id="threshold_preset-label" for="threshold_preset">Threshold Preset:</label>
<div class="html-fill-item html-fill-container">
<select id="threshold_preset" class="shiny-input-select"><option value="Strict (FC≥2, p≤0.01)">Strict (FC≥2, p≤0.01)</option>
<option value="Moderate (FC≥1.5, p≤0.05)" selected="">Moderate (FC≥1.5, p≤0.05)</option>
<option value="Lenient (FC≥1, p≤0.1)">Lenient (FC≥1, p≤0.1)</option>
<option value="Custom">Custom</option></select>
<script type="application/json" data-for="threshold_preset" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-panel-conditional html-fill-item html-fill-container" data-display-if="input.threshold_preset == 'Custom'" data-ns-prefix="">
<div class="row html-fill-item html-fill-container">
<div class="col-sm-6 html-fill-item html-fill-container">
<div class="form-group shiny-input-container html-fill-item html-fill-container">
<label class="control-label" id="logfc_threshold-label" for="logfc_threshold">Log2FC Threshold:</label>
<input id="logfc_threshold" type="number" class="shiny-input-number form-control" value="1" min="-5" max="5" step="0.1">
</div>
</div>
<div class="col-sm-6 html-fill-item html-fill-container">
<div class="form-group shiny-input-container html-fill-item html-fill-container">
<label class="control-label" id="padj_threshold-label" for="padj_threshold">P-value Threshold:</label>
<input id="padj_threshold" type="number" class="shiny-input-number form-control" value="0.05" min="0.001" max="0.1" step="0.001">
</div>
</div>
</div>
</div>
</div>
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="row html-fill-item html-fill-container">
<div class="col-sm-12 html-fill-item html-fill-container">
<h3 class="anchored">Multiple Volcano Plots by Study</h3>
<div id="multi_volcano_plots" class="shiny-html-output html-fill-item html-fill-container"></div>
<p>Volcano plot showing differentially expressed genes between selected conditions.</p>
</div>
</div>
</div>
<div class="cell-output-display html-fill-item html-fill-container">
<br>
</div>
<div class="cell-output-display html-fill-item html-fill-container">
<hr style="margin: 30px 0;">
</div>
<div class="cell-output-display html-fill-item html-fill-container">
<div class="row html-fill-item html-fill-container">
<div class="col-sm-6 html-fill-item html-fill-container">
<div class="datatables html-widget html-widget-output shiny-report-size html-fill-item html-fill-container" id="diff_expr_table" style="width:100%;height:auto;"></div>
</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div></div><div class="tab-pane html-fill-item html-fill-container" role="tabpanel" id="card-tabset-2-4"><div class="card-body html-fill-item html-fill-container" data-title="Comparative Viewer">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container no-overflow-x">
<div class="row html-fill-item html-fill-container">
<div class="col-sm-4 html-fill-item html-fill-container">
<form class="well" role="complementary">
<div class="form-group shiny-input-container html-fill-item html-fill-container">
<label class="control-label" id="normalisation_method-label" for="normalisation_method">Normalization Method</label>
<div class="html-fill-item html-fill-container">
<select id="normalisation_method" class="shiny-input-select"><option value="scaled">scaled</option>
<option value="median" selected="">median</option>
<option value="linear">linear</option>
<option value="limma">limma</option>
<option value="loess">loess</option></select>
<script type="application/json" data-for="normalisation_method" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</form>
</div>
<div class="col-sm-8 html-fill-item html-fill-container" role="main">
<div class="tabbable html-fill-item html-fill-container">
<ul class="nav nav-tabs" data-tabsetid="3997">
<li class="active">
<a href="#tab-3997-1" data-toggle="tab" data-bs-toggle="tab" data-value="PCA">PCA</a>
</li>
<li>
<a href="#tab-3997-2" data-toggle="tab" data-bs-toggle="tab" data-value="Variation PCA">Variation PCA</a>
</li>
<li>
<a href="#tab-3997-3" data-toggle="tab" data-bs-toggle="tab" data-value="Heatmap">Heatmap</a>
</li>
</ul>
<div class="tab-content html-fill-item html-fill-container" data-tabsetid="3997">
<div class="tab-pane active html-fill-item html-fill-container" data-value="PCA" id="tab-3997-1">
<div class="shiny-plot-output html-fill-item html-fill-container" id="pca_plot" style="width:100%;height:500px;"></div>
</div>
<div class="tab-pane html-fill-item html-fill-container" data-value="Variation PCA" id="tab-3997-2">
<div class="shiny-plot-output html-fill-item html-fill-container" id="variation_pca_plot" style="width:100%;height:500px;"></div>
</div>
<div class="tab-pane html-fill-item html-fill-container" data-value="Heatmap" id="tab-3997-3">
<div class="shiny-plot-output html-fill-item html-fill-container" id="heatmap_plot" style="width:100%;height:500px;"></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell-output-display html-fill-item html-fill-container">
<div class="row html-fill-item html-fill-container">
<div class="col-sm-12 html-fill-item html-fill-container">
<div class="datatables html-widget html-widget-output shiny-report-size html-fill-item html-fill-container" id="sql_to_tidyproteomics_data" style="width:100%;height:auto;"></div>
</div>
</div>
</div>
<div class="cell-output-display html-fill-item html-fill-container">
<div class="row html-fill-item html-fill-container">
<div class="col-sm-12 html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="comparative_plots" style="width:100%;height:500px;"></div>
<p>Comparative analysis across selected datasets.</p>
</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div></div><div class="tab-pane html-fill-item html-fill-container" role="tabpanel" id="card-tabset-2-5"><div class="card-body html-fill-item html-fill-container" data-title="Gene Regulatory Network (GRN)">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="out52d00e6eb3b3b41e" style="width:100%;height:400px;"></div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div></div></div><bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: ; grid-auto-columns: minmax(0, 1fr);">
<div id="3ade8a4a-fb1d-4a6c-8409-ac45482d5fc9" class="hidden html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
</div>
</div></div><aside id="bslib-sidebar-1" class="sidebar html-fill-container html-fill-item"><div class="html-fill-container html-fill-item">
<div class="cell-output-display no-overflow-x">
<div class="form-group shiny-input-container">
<label class="control-label" id="datasets-label" for="datasets">Select Dataset(s) or Study :</label>
<div>
<select id="datasets" class="shiny-input-select" multiple="multiple"><option value="Astrocyte_TurboID_vs_tdT">Astrocyte_TurboID_vs_tdT</option>
<option value="Endfoot_LPS_vs_PBS">Endfoot_LPS_vs_PBS</option>
<option value="Endfoot_Bulk_vs_Vessel">Endfoot_Bulk_vs_Vessel</option>
<option value="Human_TurboID_vs_tdT">Human_TurboID_vs_tdT</option></select>
<script type="application/json" data-for="datasets">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="form-group shiny-input-container">
<label class="control-label" id="analysis-label" for="analysis">Select Analysis Type :</label>
<div>
<select id="analysis" class="shiny-input-select"><option value=" " selected=""> </option>
<option value="QC Analysis">QC Analysis</option>
<option value="Differential expression">Differential expression</option>
<option value="Comparative Viewer">Comparative Viewer</option>
<option value="Gene Regulatory Network (GRN)">Gene Regulatory Network (GRN)</option></select>
<script type="application/json" data-for="analysis" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div class="form-group shiny-input-container" style="width:100%;">
<label class="control-label" id="search_genes-label" for="search_genes">Gene or Protein Symbol (e.g., ENSG or Uniprot ID) :</label>
<div>
<select class="shiny-input-select form-control" id="search_genes" multiple="multiple"></select>
<script type="application/json" data-for="search_genes">{"placeholder":"Start typing gene/protein name or ID...","maxOptions":30,"maxItems":null,"create":false,"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="other_filters-label" for="other_filters">Apply filter</label>
<div id="other_filters" class="tree-widget" data-return="text">
<script type="application/json" data-for="other_filters">{"data":[{"text":["Organism"],"id":["tree8858912"],"children":[{"text":["Mouse"],"id":["tree5816033"]},{"text":["Human"],"id":["tree2536151"]}]},{"text":["Organ"],"id":["tree9819108"],"children":[{"text":["Brain"],"id":["tree2390091"]},{"text":["Heart"],"id":["tree117961"]},{"text":["Lung"],"id":["tree2352897"]}]},{"text":["Cellular Filters"],"id":["tree5279856"],"children":[{"text":["Neurons"],"id":["tree8113890"]},{"text":["Astrocytes"],"id":["tree7785562"]},{"text":["Microglia"],"id":["tree5824073"]},{"text":["Oligodendrocytes"],"id":["tree8085135"]}]},{"text":["Condition"],"id":["tree6825269"],"children":[{"text":["Disease"],"id":["tree8796174"]},{"text":["Control"],"id":["tree6084458"]},{"text":["Treated"],"id":["tree9844224"]},{"text":["Untreated"],"id":["tree3281114"]}]},{"text":["Sex"],"id":["tree9131406"],"children":[{"text":["Female"],"id":["tree5262728"]},{"text":["Male"],"id":["tree1741754"]}]},{"text":["Age"],"id":["tree3705739"],"children":[{"text":["<3 years"],"id":["tree4355594"]},{"text":["3-6 years"],"id":["tree8618531"]},{"text":["6+ years"],"id":["tree5391852"]}]}],"closeDepth":0}</script>
</div>
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="qc_file-label" for="qc_file">Upload FastQC HTML or ZIP file</label>
<div class="input-group">
<label class="input-group-btn input-group-prepend">
<span class="btn btn-default btn-file">
Browse...
<input id="qc_file" class="shiny-input-file" name="qc_file" type="file" style="position: absolute !important; top: -99999px !important; left: -99999px !important;" accept=".html,.zip">
</span>
</label>
<input type="text" class="form-control" placeholder="No file selected" readonly="readonly">
</div>
<div id="qc_file_progress" class="progress active shiny-file-input-progress">
<div class="progress-bar"></div>
</div>
</div>
</div>
<div class="cell-output-display">
<button id="apply_filters" type="button" class="btn btn-default action-button">Apply Filters</button>
</div>
<div class="cell-output-display">
<button id="load_data" type="button" class="btn btn-default action-button">Load Data</button>
</div>
</div></aside>
<button class="collapse-toggle" type="button" title="Toggle sidebar" aria-expanded="true" aria-controls="bslib-sidebar-1">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" class="bi bi-chevron-left collapse-icon" style="fill:currentColor;" aria-hidden="true" role="img">
      <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"></path>
    </svg>
</button>
<script data-bslib-sidebar-init="">
bslib.Sidebar.initCollapsibleAll()
</script>
</div>
<p>
<script type="application/shiny-prerendered" data-context="server-start">
# Default CRAN mirror
options(repos = c(CRAN = "http://cran.us.r-project.org"))

# Installations & prep
packages <- c("shiny", "ggplot2", "DT", "readr", "shiny", "bslib", "shinyWidgets", "shinydashboard", "shinypanel", "RSQLite", "DBI", "glue", "fastqcr", "htmltools", "plotly", "purrr", "dplyr", "tidyverse", "tidyr", "stringr")
packages_to_install <- packages[!(packages %in% installed.packages()[, "Package"])]
if(!require(packages_to_install)) install.packages(packages_to_install, repos = "http://cran.us.r-project.org")

# For tidyproteomics
if (!require("BiocManager", quietly = TRUE))
  install.packages("BiocManager")
BiocManager::install(c("Biostrings", "limma", "qvalue", "fgsea"))
install.packages("devtools")
devtools::install_github("jeffsocal/tidyproteomics")

# Increase server limits for QC upload
options(shiny.maxRequestSize = 100*1024^2)  # 100MB limit

# Load libraries
library(ggplot2)
library(readr)
library(DT)
library(bslib)
library(shiny)
library(shinyWidgets)
library(shinydashboard)
library(shinypanel)
library(RSQLite)
library(DBI)
library(glue)
library(fastqcr)
library(htmltools)
library(plotly)
library(purrr)
library(dplyr)
library(tidyverse)
library(Biostrings)
library(tidyproteomics)
library(stringr)
library(tidyr)

con <- dbConnect(SQLite(), "data/Blanca/db_for_prototype.db")

</script>
 
<script type="application/shiny-prerendered" data-context="server">
#   NB context: server-start is not a valid place to use input$... Ensure all input$... access is inside `context: server` blocks or inside an observe() / render*() / reactive() within the server scope.
#   NB Use observe() for one-time setup (populating dropdown choices). Use output$... for dynamic content that users interact with repeatedly

# Initialise and populate reactive values for value boxes
data_holder <- reactiveValues(data = NULL)

### ~Homepage~
# Update value boxes
total_datasets <- reactive({
  tryCatch({
    dbGetQuery(con, "SELECT COUNT(DISTINCT study_name) as count FROM proteomics_study")$count[1]
  }, error = function(e) 0)
})
output$total_datasets_box <- renderValueBox({
  valueBox(
    value = total_datasets(),
    subtitle = "Total number of datasets",
    icon = icon("dna"),
    color = "blue"
  )
})

selected_datasets <- reactive({
  length(input$datasets %||% character(0))
})
output$selected_datasets_box <- renderValueBox({
  valueBox(
    value = selected_datasets(),
    subtitle = "Datasets Selected",
    icon = icon("database"),
    color = "teal"
  )
})

selected_genes <- reactive({
  length(input$search_genes %||% character(0))
})
output$selected_genes_box <- renderValueBox({
  valueBox(
    value = selected_genes(),
    subtitle = "Genes Selected",
    icon = icon("vial"),
    color = "green"
  )
})

### ~Side menu - select data~
# Filter datasets (refer to `inputId` event label), by querying and storing results in data_holder$data
observeEvent(input$datasets, {
  req(input$datasets)
  
  study_choices <- dbGetQuery(con, "SELECT DISTINCT Study_name FROM proteomics_study")
  req(all(input$datasets %in% study_choices$Study_name))  # checks if selected dataset is valid

  # Create a glue_sql-safe IN clause to prevent SQL injection
  query <- glue_sql("
    SELECT * FROM proteomics_exp
    WHERE Study_name IN ({input$datasets*})
  ", .con = con)

  filtered_query <- glue_sql("
  SELECT * FROM proteomics_exp
  WHERE Study_name IN ({input$datasets*})
  AND Organism IN ({input$organism_filter*})", .con = con)

  data_holder$data <- dbGetQuery(con, query)
  # dbDisconnect(con) # ?????????

})

# Update tabs when selecting analysis type
observeEvent(input$analysis, {
  req(input$analysis)
  if(input$analysis != " ") {
    updateTabsetPanel(session, "tabs", selected = input$analysis)
  }
})

# Update gene/ protein selection - server logic in observe blocks
observe({
  updateSelectizeInput(session, "search_genes",
    choices = unique(dbGetQuery(con, "
      SELECT DISTINCT Human_Gene FROM proteomics_exp
      UNION 
      SELECT DISTINCT Mouse_Gene FROM proteomics_exp
      UNION
      SELECT DISTINCT Uniprot_id FROM proteomics_exp
      UNION
      SELECT DISTINCT Protein_Name FROM proteomics_exp
    ")[[1]]),
    server = TRUE
  )
})

# Reactively filters the `exp_table` by gene(s) via sql query for `Experimental results` tab
      # # to exclude the `Exp_id` column: SELECT Human_Gene, Mouse_Gene, Uniprot_id, Protein_Name, abundance_A, abundance_B, logFC_A_vs_B, pvalue_A_vs_B, padj_A_vs_B FROM proteomics_exp FROM proteomics_exp
output$exp_table <- DT::renderDataTable({   # define a reactive output by creating a reactive expression to rebuild table
  req(con)    # checks db connection
  gene_filter <- input$search_genes   # gets input from `inputId`

  query <- if (!is.null(gene_filter) && length(gene_filter) > 0) {
    glue_sql("
      SELECT * FROM proteomics_exp
      WHERE Human_Gene IN ({gene_filter*})
        OR Mouse_Gene IN ({gene_filter*})
        OR Uniprot_id IN ({gene_filter*})
        OR Protein_Name IN ({gene_filter*})
    ", .con = con)
  } else {
    "SELECT * FROM proteomics_exp"
  }

  exp_data <- dbGetQuery(con, query)

  # Render data table
  DT::datatable(
    exp_data,
    caption = htmltools::tags$caption(
      style = 'caption-side: bottom; text-align: left; color: grey',
      "Experimental data from the SQL database, including logFC and adjusted p-values across comparisons."
    ),
    filter = "top",
    options = list(
      pageLength = 10,
      autoWidth = TRUE,
      scrollX = TRUE
    )
  )
})

# Update organism filter
observe({
  orgs <- dbGetQuery(con, "SELECT DISTINCT Organism FROM proteomics_study")[,1]
  updateCheckboxGroupInput(session,
    "organism_filter",
    choices = sort(unique(orgs))
  )
})

# FIXME !
# Apply all other filters
observeEvent(input$other_filters, {
  req(input$other_filters)
  selected_filters <- input$other_filters
  # Apply filters to the data
  filtered_data <- dbGetQuery(con, "SELECT * FROM proteomics_exp WHERE Organism IN ({selected_filters*})")
  data_holder$data <- filtered_data
})

### ~QC Analysis~
# Render html page of FastQC or MultiQC results, otherwise, use `fastqcr` package
output$qc_report_display <- renderUI({
  req(input$qc_file)
  ext <- tools::file_ext(input$qc_file$name)

  if (ext == "html") {
    # Display html file directly
    includeHTML(input$qc_file$datapath)
  } else if (ext == "zip") {
    # Extract and display FastQC html from zip
    temp_dir <- tempdir()
    unzip(input$qc_file$datapath, exdir = temp_dir)
    html_files <- list.files(temp_dir, pattern = "*.html", recursive = TRUE, full.names = TRUE)
    if(length(html_files) > 0) {
      includeHTML(html_files[1])
    } else {
      h4("No HTML file found in the ZIP archive.")
    }
  } else {
    h4("Unsupported file format. Please upload .html or .zip files.")
  }
})

### ~Differential Expression Analysis~

# CHECK!!!!!!!!!!!!!! - showing Significant genes: 0 / 11968 (0%)
# Render summaries for the no. of significant genes based on user-defined thresholds
output$threshold_summary <- renderText({
  req(data_holder$data)
  fc_thresh <- as.numeric(input$fc_preset)
  pval_thresh <- as.numeric(input$pval_preset)

  #..create df with significant genes
  sig_genes <- data_holder$data %>%
    filter(!is.na(logFC_A_vs_B), !is.na(padj_A_vs_B)) %>%
    summarise(
      total = n(),
      # CAN YOU ADD >=
      significant = sum(abs(as.numeric(logFC_A_vs_B)) > fc_thresh & as.numeric(padj_A_vs_B) < pval_thresh),
      .groups = 'drop'
    )

  paste0("Significant genes: ", sig_genes$significant, " / ", sig_genes$total, 
    " (", round(100 * sig_genes$significant / sig_genes$total, 1), "%)")
})

  # CHECK -log10 for padj!!!!!!!!!!!!!!
  # PROTEIN OR GENE NAME MAY BE INCORRECT AND NOT PROPERLY INCLUDED FILTERED!!! - CHECK AND FIX!!!!!!!!!!!!!
  # check or standardise axis lengths

# Dynamic UI for multiple volcano plots & table for differential expression analysis
output$multi_volcano_plots <- renderUI({
  req(data_holder$data)
  studies <- unique(data_holder$data$Study_name)    # plot per study
  selected_genes <- input$search_genes %||% character(0)  # for highlighting GOI in plots

  # Define threshold from preset selection or custom input
  selected_preset <- input$threshold_preset
  if (!is.null(selected_preset)) {
    # Extract values based on the selection structure -  NEEDS TO EDIT AS FC VS LOGFC ARE DIFFERENT!!!!!, same as above selectInput()
    if (selected_preset == "Strict (FC≥2, p≤0.01)") {
      logfc_threshold <- 2
      padj_threshold <- 0.01
    } else if (selected_preset == "Moderate (FC≥1.5, p≤0.05)") {
      logfc_threshold <- 1.5
      padj_threshold <- 0.05
    } else if (selected_preset == "Lenient (FC≥1, p≤0.1)") {
      logfc_threshold <- 1
      padj_threshold <- 0.1
    } else {
      # ...custom or fallback to default
      logfc_threshold <- input$logfc_threshold %||% 1
      padj_threshold <- input$padj_threshold %||% 0.05
    }
  } else {
    # Fallback to direct inputs if preset not selected
    logfc_threshold <- input$logfc_threshold %||% 1
    padj_threshold <- input$padj_threshold %||% 0.05
  }

  # Create individual plots for each study
  plot_outputs <- map(studies, function(study) {
    plot_id <- paste0("volcano_", gsub("[^A-Za-z0-9]", "_", study))

    # Create a rendered output
    output[[plot_id]] <- renderPlotly({
                        # # Get threshold values from inputs, otherwise use defaults
                        # logfc_threshold <- input$logfc_threshold %||% 1
                        # padj_threshold <- input$padj_threshold %||% 0.05
      # ..filter for the current study, remove NAs, and calculate significance
      study_data <- data_holder$data %>%
        filter(Study_name == study, !is.na(logFC_A_vs_B), !is.na(padj_A_vs_B)) %>%
        mutate(
          log_padj = -log10(as.numeric(padj_A_vs_B)),
          significant = ifelse(abs(as.numeric(logFC_A_vs_B)) > logfc_threshold & as.numeric(padj_A_vs_B) < padj_threshold, 
            "Significant", "Not Significant"),
          gene_label = coalesce(Human_Gene, Mouse_Gene, Uniprot_id, Protein_Name),
          highlight_genes = gene_label %in% selected_genes
        )

      if(nrow(study_data) == 0) return(plotly_empty())

      p <- ggplot(study_data, aes(x = logFC_A_vs_B, y = log_padj,
        color = significant,
        size = highlight_genes, # OR ifelse(highlight, 4, 1)
            # Hover text:       OR use coalesce() ie "Gene: ", coalesce(Gene, Human_Gene, Mouse_Gene, "Unknown")
            text = paste0(
            # "Gene: ", ifelse(!is.null(Mouse_Gene), Mouse_Gene, 
            #   ifelse(!is.null(Human_Gene), Human_Gene, "Unknown")),
            "Human_Gene     : ", Human_Gene %||% "Unknown",  #ifelse(!is.null(Human_Gene), Human_Gene, "Unknown"), 
            "\nMouse_Gene   : ", Mouse_Gene %||% "Unknown", #ifelse(!is.null(Mouse_Gene), Mouse_Gene, "Unknown"),
            "\nUniprot_id   : ", Uniprot_id %||% "Unknown", #ifelse(!is.null(Uniprot_id), Uniprot_id, "Unknown"),
            "\nProtein_Name : ", Protein_Name %||% "Unknown",# ifelse(!is.null(Protein_Name), Protein_Name, "Unknown"),
            "\nlogFC        : ", round(as.numeric(logFC_A_vs_B), 3),
            "\np-adj        : ", format(padj_A_vs_B, scientific = TRUE, digits = 3),
            "\n-log10(p-adj): ", round(log_padj, 3),
            "\nsignificant? : ", significant
          )
          )) +
        geom_point(alpha = 0.7) +
        geom_hline(yintercept = -log10(padj_threshold), linetype = "dashed") +
        geom_vline(xintercept = c(-logfc_threshold, logfc_threshold), linetype = "dashed") +
        scale_color_manual(values = c("Not Significant" = "grey", "Significant" = "red")) +
        scale_size_manual(values = c("TRUE" = 4, "FALSE" = 1)) +
        labs(x = "Log2 Fold Change", y = "-log10(adjusted P-value)", 
          title = paste("Volcano Plot:", study)) +
        theme_minimal()

      ggplotly(p, height = 400)
    })

    # Return UI element
    div(
      class = "col-md-6",
      style = "margin-bottom: 20px;",
      h4(study, style = "text-align: center;"),
      plotlyOutput(plot_id, height = "400px")
    )
  })

  # Wrap in fluidRow
  do.call(fluidRow, plot_outputs)
})

### DOES THIS FILTER WITH USER-DEFINED INPUTS??????? - CHECK
# Render table
output$diff_expr_table <- DT::renderDataTable({
  req(data_holder$data)

  # Filter for significant results
  if("padj_A_vs_B" %in% names(data_holder$data)) {
    sig_data <- data_holder$data[data_holder$data$padj_A_vs_B < 0.05, ]
  } else {
    sig_data <- data_holder$data
  }

  DT::datatable(sig_data,
    caption = "Significantly differentially expressed genes (padj < 0.05)",
    options = list(pageLength = 10,scrollX = TRUE),
    filter = 'top'
  )
})


### ~Comparative Viewer~

# First, create function to create a suitable object from SQLite data, for tidyproteomics package
create_tidyproteomics_from_sql <- function(con, datasets = NULL, search_genes = NULL) {

  # Create a basic tidyproteomics object structure
  tidy_obj <- list()
  if (class(tidy_obj) != "tidyproteomics") {
    class(tidy_obj) <- "tidyproteomics"
  }

      ## CHECK IF `LEFT JOIN proteomics_proteins USING (Uniprot_id)` IS NEEDED BEFORE WHERE STATEMENT??????
  # Query database based on user-defined filters
  query <- if (!is.null(search_genes) && length(search_genes) > 0 && !is.null(datasets) && length(datasets) > 0) {
    glue_sql("
      SELECT * FROM proteomics_exp
      WHERE Study_name IN ({datasets*})
        AND (
          Human_Gene IN ({search_genes*})
          OR Mouse_Gene IN ({search_genes*})
          OR Uniprot_id IN ({search_genes*})
          OR Protein_Name IN ({search_genes*})
        )
    ", .con = con)
  } else {
    "SELECT * FROM proteomics_exp"
  }

  # Get data from database
  exp_data <- dbGetQuery(con, query)

            # Get unique study names to create sample columns
            studies <- unique(exp_data$Study_name)

  # Transform data to format expected by tidyproteomics - check: https://github.com/vdemichev/DiaNN?tab=readme-ov-file#main-output-reference
  # ...reshape into long format
  reshaped_data <- exp_data %>%
    mutate(across(starts_with("abundance_"), as.numeric)) %>%  # due to SQL data type, REAL, also containing NAs
    select(
      Exp_id,
      Uniprot_id,
      Protein_Name,
      Protein_Description,
      Human_Gene,
      Mouse_Gene,
      Study_name,
      sample_A = Sample_or_condition_A,
      sample_B = Sample_or_condition_B,
      abundance_A,
      abundance_B
    ) %>%
    # ..create sample columns from samples/ conditions
    pivot_longer(
      cols = c(abundance_A, abundance_B, sample_A, sample_B), names_to = c(".value", "temp"), names_sep = "_"   # cols = c(abundance_A, abundance_B), names_to = "condition", values_to = "abundance") %>% 
    ) %>%
    select(-sample) %>%
    dplyr::rename(sample = temp) %>%  # sample or condition????

    # ~NEEDED???~
    # ...create gene column while prioritising 'Human_Gene' where available
    mutate(
      gene = ifelse(!is.na(Mouse_Gene) & Mouse_Gene != "", Mouse_Gene, Human_Gene) 
    ) %>%

    # ...select mandatory columns
    select(Uniprot_id, Protein_Name, Protein_Description, gene, Study_name, sample, abundance)

  # ...define annotation table, 
  annotations <- reshaped_data %>%
    select(Uniprot_id, Protein_Name, Protein_Description)

  # ...define experimental table
  experiments <- reshaped_data %>%
    select(Study_name, sample, abundance) %>%
    # distinct() %>%    # exclude distinct() as may contain replicates
    dplyr::rename(import_file = Study_name)

  # ...define sample metadata
  samples <- reshaped_data %>%
    select(sample)      # exclude distinct() as may contain replicates

  # ...define abundance table
  quantitation <- reshaped_data %>%
    select(
      sample,
      gene,
      Uniprot_id,
      abundance
    ) %>%

  # Build tidyproteomics object
  tidy_obj$origin <- "SQL_imported_data"
  tidy_obj$annotations <- annotations
  tidy_obj$samples <- samples
  tidy_obj$quantitation <- quantitation
  tidy_obj$experiments <- experiments
  tidy_obj$counts <- list(
    proteins = nrow(annotations),
    samples = nrow(samples)
  )
  tidy_obj$metadata <- list(
    data_origin = "SQLite database imported",
    db_name = basename(dbGetInfo(con)$dbname),
    import_date = Sys.time()
  )

  return(tidy_obj)

}

# Use in reactive context
sql_tidyproteomics_data <- reactive({
  # check filtered data is available
  req(con, input$search_genes, input$datasets)

  # ...create tidyproteomics object
  create_tidyproteomics_from_sql(con = con,
    datasets = input$datasets,
    search_genes = input$search_genes)
})


# Create tidyproteomics-based plots

# First display transformed data
if (!inherits(data, "tidyproteomics")) {
  # stop("Data must be a tidyproteomics object.")
} else {
  output$sql_to_tidyproteomics_data <- DT::renderDataTable({
  req(sql_tidyproteomics_data)

  DT::datatable(
    sql_tidyproteomics_data,
    caption = htmltools::tags$caption(
      style = 'caption-side: bottom; text-align: left; color: grey',
      " SERVER : PROOF OF sql_to_tidyproteomics_data ."
    ),
    filter = "top",
    options = list(
      pageLength = 10,
      autoWidth = TRUE,
      scrollX = TRUE
    )
  )
  })
}



# Principal component analysis (PCA) of abundance levels (??? or Fold-Change ???) to determine the principle axes of abundance variation
output$pca_plot <- renderPlot({
  req(sql_tidyproteomics_data)
  sql_tidyproteomics_data %>%
    normalize(.method = input$normalisation_method) %>%
    select_normalization() %>%
    plot_pca()
})

# Plot variation PCA
output$variation_pca_plot <- renderPlot({
  req(sql_tidyproteomics_data)
  sql_tidyproteomics_data %>%
    normalize(.method = input$normalisation_method) %>%
    select_normalization() %>%
    plot_variation_pca()
})

# Heatmap of clustered samples and abundance levels
  output$heatmap_plot <- renderPlot({
    req(sql_tidyproteomics_data())
    sql_tidyproteomics_data %>%
      select_normalization() %>%
      plot_heatmap()
  })

# Expression Heatmap
# Correlation Heatmap


### ~Gene Regulatory Network (GRN)~

</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(
    function(q, nm, val) {
      # Infer name, if possible
      if (nm == "") {
        tryCatch(
          {
            nm <- rlang::as_name(q)
          },
          error = function(e) {
            code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
            stop(
              "ojs_define() could not create a name for the argument: ",
              code
            )
          }
        )
      }
      .session$output[[nm]] <- val
      outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
      .session$sendCustomMessage("ojs-export", list(name = nm))
      NULL
    },
    quos,
    nm,
    vars,
    SIMPLIFY = FALSE,
    USE.NAMES = FALSE
  )
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["treejs"]},{"type":"character","attributes":{},"value":["1.8.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["packer"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tree.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shinyWidgets"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.9.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets"]},{"type":"character","attributes":{},"value":["1.6.4"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmlwidgets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmlwidgets"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.6.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["datatables-css"]},{"type":"character","attributes":{},"value":["0.0.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets/css"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["datatables-crosstalk.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["DT"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.33"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["datatables-binding"]},{"type":"character","attributes":{},"value":["0.33"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["datatables.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["DT"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["0.33"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.5.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["crosstalk"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["crosstalk"]},{"type":"character","attributes":{},"value":["1.2.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/crosstalk.min.js"]},{"type":"character","attributes":{},"value":["css/crosstalk.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["crosstalk"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets"]},{"type":"character","attributes":{},"value":["1.6.4"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmlwidgets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmlwidgets"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.6.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["datatables-css"]},{"type":"character","attributes":{},"value":["0.0.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets/css"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["datatables-crosstalk.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["DT"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.33"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["datatables-binding"]},{"type":"character","attributes":{},"value":["0.33"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["datatables.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["DT"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["0.33"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.5.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["crosstalk"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["crosstalk"]},{"type":"character","attributes":{},"value":["1.2.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/crosstalk.min.js"]},{"type":"character","attributes":{},"value":["css/crosstalk.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["crosstalk"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets"]},{"type":"character","attributes":{},"value":["1.6.4"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmlwidgets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmlwidgets"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.6.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["datatables-css"]},{"type":"character","attributes":{},"value":["0.0.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets/css"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["datatables-crosstalk.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["DT"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.33"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["datatables-binding"]},{"type":"character","attributes":{},"value":["0.33"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["datatables.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["DT"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["0.33"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["3.5.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["crosstalk"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["crosstalk"]},{"type":"character","attributes":{},"value":["1.2.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/crosstalk.min.js"]},{"type":"character","attributes":{},"value":["css/crosstalk.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["crosstalk"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102]}},"value":[{"type":"character","attributes":{},"value":["base","BiocGenerics","BiocManager","Biostrings","bit","bit64","blob","bslib","cachem","cli","compiler","crayon","crosstalk","curl","data.table","datasets","DBI","devtools","digest","dplyr","DT","ellipsis","evaluate","farver","fastmap","fastqcr","forcats","fs","generics","GenomeInfoDb","GenomeInfoDbData","ggplot2","glue","graphics","grDevices","grid","gtable","hms","htmltools","htmlwidgets","httpuv","httr","IRanges","jquerylib","jsonlite","knitr","later","lazyeval","lifecycle","lubridate","magrittr","memoise","methods","mime","miniUI","pillar","pkgbuild","pkgconfig","pkgload","plotly","profvis","promises","purrr","R6","RColorBrewer","Rcpp","readr","remotes","rlang","rmarkdown","RSQLite","S4Vectors","sass","scales","sessioninfo","shiny","shinydashboard","shinypanel","shinyWidgets","stats","stats4","stringi","stringr","tibble","tidyproteomics","tidyr","tidyselect","tidyverse","timechange","tools","tzdb","UCSC.utils","urlchecker","usethis","utils","vctrs","viridisLite","withr","xfun","xtable","XVector","yaml"]},{"type":"character","attributes":{},"value":["4.5.0","0.54.0","1.30.25","2.76.0","4.6.0","4.6.0-1","1.2.4","0.9.0","1.1.0","3.6.5","4.5.0","1.5.3","1.2.1","6.2.2","1.17.2","4.5.0","1.2.3","2.4.5","0.6.37","1.1.4","0.33","0.3.2","1.0.3","2.1.2","1.2.0","0.1.3","1.0.0","1.6.6","0.1.4","1.44.0","1.2.14","3.5.2","1.8.0","4.5.0","4.5.0","4.5.0","0.3.6","1.1.3","0.5.8.1","1.6.4","1.6.16","1.4.7","2.42.0","0.1.4","2.0.0","1.50","1.4.2","0.2.2","1.0.4","1.9.4","2.0.3","2.0.1","4.5.0","0.13","0.1.2","1.10.2","1.4.7","2.0.3","1.4.0","4.10.4","0.4.0","1.3.2","1.0.4","2.6.1","1.1-3","1.0.14","2.1.5","2.5.0","1.1.6","2.29","2.3.11","0.46.0","0.4.10","1.4.0","1.2.3","1.10.0","0.7.3","0.1.5","0.9.0","4.5.0","4.5.0","1.8.7","1.5.1","3.2.1","1.8.6","1.3.1","1.2.1","2.0.0","0.3.0","4.5.0","0.5.0","1.4.0","1.0.1","3.1.0","4.5.0","0.6.5","0.4.2","3.0.2","0.52","1.8-4","0.48.0","2.3.10"]}]}]}
</script>
<!--/html_preserve-->

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->

<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (_event) {
  if (window.bslib.Card) {
    window.bslib.Card.initializeAllCards();
  }
}); 
</script>
  



</body></html>